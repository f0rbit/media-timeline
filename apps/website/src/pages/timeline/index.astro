---
import TimelineList from "../../components/solid/TimelineList";
import AppLayout from "../../layouts/AppLayout.astro";
import { type ProfileTimelineResponse, type TimelineGroup, api } from "../../utils/api";

const profileSlug = Astro.url.searchParams.get("profile");

let initialGroups: TimelineGroup[] = [];

if (profileSlug) {
	try {
		const runtime = Astro.locals.runtime;
		const result = await api.ssr<ProfileTimelineResponse>(`/media/api/v1/profiles/${profileSlug}/timeline`, Astro.request, {}, runtime);

		if (result.ok) {
			initialGroups = result.data.data.groups;
		}
	} catch {
		// SSR fetch failed, component will fetch client-side
	}
}
---

<AppLayout 
  title="Timeline | Media Timeline"
  description="Your aggregated activity feed from GitHub, Reddit, Twitter, and more."
  noindex={true}
>
  <section>
    <h1 class="page-title">Timeline</h1>
    <p class="description">Your aggregated activity across all connected platforms.</p>
  </section>
  <div class="timeline-skeleton">
    <TimelineList 
      client:load
      profileSlug={profileSlug}
      initialGroups={initialGroups}
    />
  </div>
</AppLayout>

<style>
  /* Prevent layout shift while client component loads */
  .timeline-skeleton {
    min-height: 200px;
  }
</style>
