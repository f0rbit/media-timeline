name = "media-timeline-api"
main = "dist/_worker.js"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

[assets]
directory = "dist"
binding = "ASSETS"

[triggers]
crons = ["*/5 * * * *"]

# Production environment (default)
[vars]
ENVIRONMENT = "production"
API_URL = "https://media.devpad.tools"
FRONTEND_URL = "https://media.devpad.tools"

[[d1_databases]]
binding = "DB"
database_name = "media-timeline-db"
database_id = "fee9822f-cc95-422b-bcff-5aad177d5dfb"
migrations_dir = "migrations"

[[r2_buckets]]
binding = "CORPUS_BUCKET"
bucket_name = "media-timeline-corpus"

[[routes]]
pattern = "media.devpad.tools"
custom_domain = true

# Preview environment
[env.preview]
name = "media-timeline-api-preview"

[env.preview.triggers]
crons = ["*/5 * * * *"]

[env.preview.assets]
directory = "dist"
binding = "ASSETS"

[env.preview.vars]
ENVIRONMENT = "preview"
API_URL = "https://media-preview.devpad.tools"
FRONTEND_URL = "https://media-preview.devpad.tools"

[[env.preview.d1_databases]]
binding = "DB"
database_name = "media-timeline-db-preview"
database_id = "2ccc9ddc-4d16-4060-bf43-b6312d7ba5e4"
migrations_dir = "migrations"

[[env.preview.r2_buckets]]
binding = "CORPUS_BUCKET"
bucket_name = "media-timeline-corpus-preview"

[dev]
port = 8787
local_protocol = "http"

[observability]
enabled = true

[observability.logs]
enabled = true
invocation_logs = true

[env.preview.observability]
enabled = true

[env.preview.observability.logs]
enabled = true
invocation_logs = true
